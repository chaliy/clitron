# Clitron

A Rust library for building human-friendly CLI interfaces using small language models.

Instead of memorizing exact command syntax like `gh pr list --state open --author @me`, users can simply type:

```bash
hgh "show my open pull requests"
```

## How It Works

1. **Small Language Model**: Uses a fine-tuned small LLM (Llama 3.2 1B) that can run locally
2. **RL Training**: The model is trained using data generated by a large LLM (Claude Opus) and refined with DPO
3. **Schema-Driven**: CLI commands are defined in YAML schemas that guide both training and interpretation
4. **Clap Integration**: Seamlessly integrates with Rust's clap library for CLI parsing

## Demo

### HGH Demo CLI

`hgh` (Human GitHub) wraps the official `gh` CLI with natural language understanding.

#### Installation

```bash
# Install from the repository
cargo install --git https://github.com/chaliy/clitron.git hgh
```

#### Usage

```bash
# Natural language commands
hgh "show my open prs"
hgh "list merged pull requests"
hgh "create a pr for this branch"
hgh "view pr 123"
hgh "show issues with bug label"
hgh "list failed workflow runs"

# Options
hgh -e "show prs"       # Explain: show interpreted command
hgh -n "show prs"       # Dry run: don't execute
hgh -c "merge pr 123"   # Confirm before executing
hgh -r pr list          # Raw: bypass interpretation
```

## Project Structure

```
clitron/
├── clitron/          # Core Rust library
├── hgh/              # Demo: Human GitHub CLI
├── training/         # Python training pipeline
├── schemas/          # CLI schema definitions
├── specs/            # Project specifications
├── AGENTS.md         # AI agent documentation
└── justfile          # Task runner
```

## Quick Start

### Using just (recommended)

```bash
# Install just if needed
cargo install just

# See all available commands
just

# Build everything
just build

# Run tests
just test

# Try the demo CLI
just hgh "show my open prs"
```

### Manual Setup

```bash
# Build the project
cargo build --workspace

# Run the hgh demo
cargo run -p hgh -- "show my open pull requests"
```

## Training a Model

The training pipeline uses Claude Opus to generate training data, then fine-tunes a small model.

```bash
# Set up training environment
just train-setup

# Run full training pipeline (requires ANTHROPIC_API_KEY)
export ANTHROPIC_API_KEY=your-key
just train-all

# Or run individual stages
just train-generate      # Generate training data
just train-sft           # Supervised fine-tuning
just train-dpo           # DPO training
just train-quantize      # Convert to GGUF
just train-eval          # Evaluate model
```

## Using the Library

```rust
use clitron::{Interpreter, CommandSchema};

fn main() -> anyhow::Result<()> {
    // Load your CLI schema
    let schema = CommandSchema::from_yaml_file("schema.yaml")?;

    // Create an interpreter
    let interpreter = Interpreter::with_schema(schema)?;

    // Interpret natural language input
    let cmd = interpreter.interpret("show my open pull requests")?;

    println!("Command: {}", cmd.command);           // "pr"
    println!("Subcommand: {:?}", cmd.subcommand);   // Some("list")
    println!("Args: {:?}", cmd.args);               // {"state": "open", "author": "@me"}
    println!("Confidence: {:.0}%", cmd.confidence * 100.0);

    // Convert to CLI args
    let args = cmd.to_args();  // ["pr", "list", "--state", "open", "--author", "@me"]

    Ok(())
}
```

## Specifications

See the `specs/` directory for detailed documentation:

- [ARCHITECTURE.md](specs/ARCHITECTURE.md) - System architecture
- [MODEL.md](specs/MODEL.md) - Model selection and requirements
- [TRAINING.md](specs/TRAINING.md) - Training pipeline
- [RUST_LIB.md](specs/RUST_LIB.md) - Rust library design
- [HGH_CLI.md](specs/HGH_CLI.md) - Demo CLI specification

## Requirements

- Rust 1.75+
- Python 3.10+ (for training)
- `gh` CLI (for hgh demo)
- ANTHROPIC_API_KEY (for training data generation)

## License

MIT
